(()=>{"use strict";var t={855:(t,e,s)=>{t.exports=s.p+"73466bd5af986ad9ccc8.bmp"}},e={};function s(i){var n=e[i];if(void 0!==n)return n.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,s),a.exports}s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),(()=>{class t{}class e{getPattern(){return this.pattern}getSongPos(){return this.songPos}constructor(e){this.songPos=0,this.songTime=0,this.temp=new Float32Array(4096),this.status=!1,this.noise=0,this.instruments=[new t,new t,new t],this.pattern=[[255,255,255,255,1,255,255,255,255,255,255,255,1,255,255,255,1,255,1,255,1,1,255,1,1,255,1,1,1,255,1,255],[32,255,32,30,255,30,255,30,255,255,32,30,255,30,44,20,32,255,32,30,255,30,255,30,255,255,32,30,255,30,44,20],[64,255,64,30,255,30,255,30,255,255,32,30,255,30,44,20,64,255,64,30,64,52,76,30,255,255,32,30,255,30,44,20]],this.lastOut=0,this.sampleRate=e,this.currentPhase=0,this.tempo=Math.floor(e/8)}getSamples(t){for(let e=0;e<t.length;e++){if(this.songTime%this.tempo==0){for(let t=0;t<3;t++){this.instruments[t].on=!1;let e=this.pattern[t][this.songPos%this.pattern[t].length];255!==e&&(this.instruments[t].on=!0,this.instruments[t].currentPhase=0,this.instruments[t].envelope=0,this.instruments[t].phaseIncrement=2*Math.PI*this.pitchToFrequency(e)/this.sampleRate)}this.songPos++}let s=0;for(let t=0;t<3;t++)this.instruments[t].on&&(this.instruments[t].currentPhase+=this.instruments[t].phaseIncrement,this.songTime%this.tempo<.05*this.tempo&&(this.instruments[t].envelope+=1/(.05*this.tempo)),this.songTime%this.tempo>=.05*this.tempo&&(this.instruments[t].envelope-=1/(.95*this.tempo)),this.instruments[t].envelope=Math.max(0,Math.min(this.instruments[t].envelope,1)),0===t?s+=(2*Math.random()-1)*this.instruments[t].envelope*.7:1===t?s+=(Math.sin(this.instruments[t].currentPhase)>0?1:-1)*this.instruments[t].envelope*.5:2===t&&(s+=Math.sin(this.instruments[t].currentPhase)*this.instruments[t].envelope));t[e]=this.clipSignal(.4*s),this.songTime++}}lowPassFrequency(t){let e=1/this.sampleRate,s=e/(.0003980891719745223+e);return this.lastOut+=s*(t-this.lastOut),this.lastOut}shapingFunction(t,e){return Math.sin(t*t*t*8+.015*e)}clipSignal(t){return Math.min(Math.max(t,-1),1)}pitchToFrequency(t){const e=(t-69)/12;return 440*Math.pow(2,e)}}const i=s.p+"822f0dd7944339eb92e4.bmp";class n{constructor(){this.lastTime=0,this.activeChannel=0,this.activeRow=0,this.currentOctave=5}main(){const t=document.getElementById("synth").getContext("2d"),a=new AudioContext;let h;h=a.createScriptProcessor(n.BUFFER_SIZE,1,1),this.synthesizer=new e(a.sampleRate),h.onaudioprocess=t=>{const e=t.outputBuffer.getChannelData(0);this.synthesizer.getSamples(e)},a.audioWorklet.addModule("synthesizer.audio-worklet.js").then((()=>{const t=new AudioWorkletNode(a,"synthesizer-processor");t.connect(a.destination),this.analyser=a.createAnalyser(),this.analyser.fftSize=2048;const e=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(e),t.connect(this.analyser),this.analyser.connect(a.destination)})),window.onkeydown=t=>{const e=t.keyCode?t.keyCode:t.which;if(console.log("key: "+e),39===e)console.log("right"),this.activeChannel=(this.activeChannel+1)%4;else if(37===e)console.log("left"),this.activeChannel=(this.activeChannel+4-1)%4;else if(38===e)console.log("up"),this.activeRow=(this.activeRow+32-1)%32;else if(107===e)console.log("left"),this.currentOctave=(this.currentOctave+1)%12;else if(109===e)console.log("up"),this.currentOctave=(this.currentOctave+12-1)%12;else if(40===e)console.log("down"),this.activeRow=(this.activeRow+1)%32;else if(46===e){console.log("del");const t=this.synthesizer.getPattern();console.log(t[this.activeChannel][this.activeRow]),t[this.activeChannel][this.activeRow]=255,console.log(t[this.activeChannel][this.activeRow]),this.activeRow=(this.activeRow+1)%32}else 89===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=0+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):83===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=1+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):88===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=2+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):68===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=3+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):67===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=4+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):86===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=5+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):71===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=6+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):66===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=7+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):72===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=8+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):78===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=9+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):74===e?(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=10+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32):77===e&&(this.synthesizer.getPattern()[this.activeChannel][this.activeRow]=11+12*this.currentOctave,this.activeRow=(this.activeRow+1)%32)},this.image=new Image,this.image.onload=e=>{this.image2=new Image,this.image2.onload=e=>{requestAnimationFrame((()=>this.draw(t)))},this.image2.src=i},this.image.src=s(855)}draw(t){t.fillStyle="#333333",t.fillRect(0,0,640,480),this.analyser&&this.drawOscilloscop(t,200,50);const e=Math.floor(.02*Date.now())%63;t.drawImage(this.image,32*e,0,32,32,240,0,32,32),t.fillStyle="#b3c13f",t.fillRect(10,70,368,256),this.drawPattern(t,10,70),this.drawActivePos(t,this.activeChannel,this.activeRow),requestAnimationFrame((()=>this.draw(t)))}drawActivePos(t,e,s){const i=this.synthesizer.getSongPos()%32;t.strokeStyle="#00ff00",t.lineWidth=2,t.strokeRect(8+96*e,68+8*i,252,11),t.strokeStyle="#ff1100",t.lineWidth=2,t.strokeRect(8+96*e,68+8*s,84,11)}drawText(t,e,s,i){for(let n=0;n<i.length;n++)this.drawChar(t,e+8*n,s,i.charCodeAt(n))}drawPattern(t,e,s){const i=this.synthesizer.getPattern();for(let a=0;a<3;a++)for(let h=0;h<32;h++)if(255===i[a][h])this.drawText(t,e+12*a*8,s+8*h,"--- -- --");else{let r=i[a][h];this.drawText(t,e+12*a*8,s+8*h,n.noteRepresentations[r%12]+Math.floor(r/12)+" -- --")}}drawChar(t,e,s,i){const n=i-" ".charCodeAt(0),a=n%16,h=Math.floor(n/16);t.drawImage(this.image2,8*a,8*h,8,8,e,s,8,8)}drawOscilloscop(t,e,s){t.save(),t.translate(10.5,10.5),t.fillStyle="#002200",t.fillRect(0,0,e,s),Date.now()-this.lastTime>80&&(this.analyser&&this.analyser.getByteTimeDomainData(this.dataArray),this.lastTime=Date.now()),t.lineWidth=3,t.strokeStyle="rgb(0.3, 1, 0.3)",t.beginPath(),t.strokeStyle="#BBFF00";for(let i=0;i<90;i++){const n=e*i/90,a=Math.floor(this.dataArray.length/90*i),h=4+this.dataArray[a]/256*(s-8);0===i?t.moveTo(n,h):t.lineTo(n,h)}t.stroke(),t.strokeStyle="#001100",t.lineWidth=1,t.strokeRect(0,0,e,s),t.restore()}}n.BUFFER_SIZE=4096,n.noteRepresentations=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],document.getElementById("button").onclick=()=>(new n).main()})()})();
//# sourceMappingURL=main.bundle.js.map